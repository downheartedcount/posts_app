# Политика безопасности проекта `posts_app`

Этот документ описывает ключевые принципы безопасности, используемые в проекте, а также планы по их дальнейшему развитию.


---

## Основные принципы

- **Принцип наименьших привилегий** - только необходимые доступы  
- **Безопасность по умолчанию** - приложение должно быть безопасным без дополнительных настроек  
- **Конфигурация вместо кода** - секреты и настройки не хранятся в коде  
- **Нулевое доверие** - все внешние данные считаются небезопасными  

---

## Валидация входных данных

- Все входные данные проходят строгую валидацию через **Pydantic**  
- Используются схемы данных с ограничениями (`constr`, `PositiveInt` и др.)  
- API принимает только явно определённые схемы  

---

## Управление конфигурацией и секретами

- Все чувствительные данные загружаются из файла `.env` через `pydantic-settings`  
- `.env` не хранится в git (добавлен в `.gitignore`)  
- Все важные параметры объявлены как обязательные и валидируются в `AppConfig`  

---

## Политика CORS

- Список разрешённых доменов CORS берётся только из переменной `.env` (`CORS_ORIGINS`)  
- Использование `*` для CORS запрещено  
- Разрешены только необходимые заголовки (`Content-Type`, `Authorization`)  
- В продакшене CORS строго контролируется  

---

## Доступ к базе данных

- PostgreSQL работает только внутри приватной сети Docker (`app_net`)  
- Порты PostgreSQL не публикуются наружу (`expose` вместо `ports`)  
- Используются уникальные и надёжные пароли, передаваемые через `.env`  
- В коде отсутствуют дефолтные или жёстко заданные пароли  

---

## Безопасность Docker

- Контейнер приложения запускается не от root, а под пользователем `appuser`  
- Файловая система контейнера монтируется в режиме `read_only`  
- Временные файлы размещаются в `tmpfs` (в памяти)  
- Включена опция `no-new-privileges:true`  
- Установлены только необходимые пакеты и зависимости  

---

## Аутентификация и токены (Масштабируемость)

План внедрения аутентификации на основе токенов:

- **Токены доступа** (JWT или opaque) будут выдаваться клиентам после авторизации  
- Токены будут иметь права доступа и ограниченный срок действия  

### Хранение и использование токенов:

- Токены будут храниться в HTTP-only cookies **или** в памяти клиента  
- Секреты для подписи токенов и клиентские ключи:
  - Хранятся только в переменных окружения  
  - Могут управляться через **Docker Secrets** или **HashiCorp Vault** в продакшене  
- API будет защищено через зависимости FastAPI (`Depends(get_current_user)`) или middleware  

---

##  Управление зависимостями и уязвимостями

- Для управления зависимостями используется **Poetry**  
- Для проверки уязвимостей:
  - `poetry audit`  
  - `safety check`  
- Запрещено использовать неконтролируемые версии зависимостей (`*`, `^`)  

---

## CI/CD и DevSecOps (Планируется)

- Все изменения проходят:
  - Проверку стиля кода (`flake8`, `black`)  
  - Сканирование на наличие секретов (например, `truffleHog`, `GitGuardian`)  
  - Аудит зависимостей  
- В продакшн выкладываются только проверенные и протестированные образы Docker  


---

_Последнее обновление: 16 июля 2025_
